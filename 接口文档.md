# DBMS 后端接口文档（C++）

## 模块概览
- `StorageEngine`：读写二进制 `.dbf`（表结构）与 `.dat`（记录数据）。
- `DDLService`：表定义管理（创建、重命名、删除、字段编辑）。
- `DMLService`：数据插入、删除、更新。
- `QueryService`：单表查询，支持条件过滤与列投影。
- `Parser`：简易 SQL 解析，输出 `ParsedCommand` 结构。

## 核心数据结构
- `Field { name, type, size, isKey, nullable, valid }`
- `TableSchema { tableName, vector<Field> fields }`
- `Record { valid, vector<string> values }`
- `Condition { fieldName, op ("=", "!=", "CONTAINS"), value }`
- `QueryPlan { projection, conditions }`

## StorageEngine
- `bool LoadSchemas(dbfPath, outSchemas, err)`：读取全部表定义。
- `bool SaveSchemas(dbfPath, schemas, err)`：覆盖写回表定义。
- `bool AppendSchema(dbfPath, schema, err)`：追加表定义。
- `bool AppendRecord(datPath, schema, record, err)`：追加单条记录。
- `bool ReadRecords(datPath, schema, outRecords, err)`：读取单表全部记录。
- `bool SaveRecords(datPath, schema, records, err)`：覆盖写回记录集。

## DDLService
- `CreateTable(dbf, dat, schema, err)`：新增表并初始化空数据区。
- `RenameTable(dbf, dat, oldName, newName, err)`：重命名表，迁移数据。
- `DropTable(dbf, dat, tableName, err)`：删除表定义并清空数据文件。
- `EditField(dbf, tableName, newField, err)`：新增或覆盖字段定义。

## DMLService
- `Insert(dat, schema, record, err)`：插入记录，自动追加。
- `Delete(dat, schema, cond, err)`：按条件逻辑删除（valid 置 0）。
- `Update(dat, schema, cond, assignments, err)`：按条件更新字段值。

## QueryService
- `Select(dat, schema, plan, out, err)`：
  - 过滤：按 `plan.conditions` 等值/包含匹配。
  - 投影：按 `plan.projection` 选择列，为空则返回全部列。

## Parser
- 输入：一条 SQL 字符串。
- 输出：`ParsedCommand`，包含 `type`（CREATE/INSERT/SELECT/...）、表名、库名、schema/record/query/condition 等解析结果。
- 现支持：
  - `CREATE TABLE t (...) INTO db`
  - `INSERT INTO t VALUES(...) IN db`
  - `SELECT ... FROM t [WHERE field = value]`

## 使用示例（见 src/main.cpp）
- 创建表 `Users`，插入记录，并使用 `QueryService` 按条件查询。